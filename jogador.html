<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÅ Criar C√°psula do Tempo</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary: #2D5A4C;
            --primary-light: #3D7A66;
            --accent: #E8B86D;
            --accent-light: #F5D49A;
            --bg-dark: #0F1419;
            --bg-card: #1A2332;
            --bg-elevated: #243447;
            --text: #F4F4F5;
            --text-muted: #9CA3AF;
            --success: #10B981;
            --error: #EF4444;
            --radius: 20px;
            --radius-sm: 12px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }
        
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        /* BACKGROUND */
        .bg-gradient {
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(45,90,76,0.2) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(232,184,109,0.15) 0%, transparent 40%);
            pointer-events: none;
        }

        /* CONTAINER */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        /* PROGRESS BAR */
        .progress-container {
            margin-bottom: 32px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .progress-step-text {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .progress-step-name {
            font-size: 0.85rem;
            color: var(--accent);
            font-weight: 500;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* TELAS */
        .tela {
            display: none;
            flex-direction: column;
            flex: 1;
            animation: slideIn 0.4s ease;
        }
        
        .tela.active { display: flex; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* HEADER TELA */
        .tela-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .tela-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        .tela-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: var(--text);
        }
        
        .tela-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
            line-height: 1.5;
        }

        /* FOTO SECTION */
        .foto-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 28px;
        }
        
        .foto-preview {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 4px solid var(--bg-elevated);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .foto-preview.has-photo {
            border-color: var(--accent);
            box-shadow: 0 0 40px rgba(232,184,109,0.3);
        }
        
        .foto-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .foto-placeholder {
            text-align: center;
            color: var(--text-muted);
        }
        
        .foto-placeholder .icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .foto-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn-foto {
            padding: 12px 20px;
            background: var(--bg-card);
            border: 2px solid var(--bg-elevated);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-foto:hover {
            border-color: var(--accent);
            background: rgba(232,184,109,0.1);
        }
        
        .camera-container {
            display: none;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
        }
        
        .camera-container.active { display: flex; }
        
        .camera-video {
            width: 100%;
            max-width: 280px;
            border-radius: var(--radius-sm);
            background: #000;
            transform: scaleX(-1);
        }
        
        .camera-actions {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }
        
        .btn-capture {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: var(--accent);
            border: 4px solid white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-capture:hover { transform: scale(1.1); }
        
        .btn-cancel-camera {
            background: transparent;
            border: 2px solid var(--text-muted);
            color: var(--text-muted);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
        }

        /* FORM */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text);
            font-size: 1rem;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--bg-elevated);
            border-radius: var(--radius-sm);
            background: var(--bg-card);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(232,184,109,0.05);
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--text-muted);
        }
        
        .form-group textarea {
            resize: none;
            min-height: 150px;
            line-height: 1.6;
        }
        
        .char-counter {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* TAGS / DESEJOS */
        .tags-section {
            margin-bottom: 24px;
        }
        
        .tags-counter {
            text-align: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            color: var(--accent);
            font-weight: 600;
        }
        
        .categoria {
            margin-bottom: 24px;
        }
        
        .categoria-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tags-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .tag {
            padding: 10px 18px;
            background: var(--bg-card);
            border: 2px solid var(--bg-elevated);
            border-radius: 25px;
            color: var(--text);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tag:hover {
            border-color: rgba(232,184,109,0.5);
        }
        
        .tag.selected {
            background: rgba(232,184,109,0.2);
            border-color: var(--accent);
            color: var(--accent);
            font-weight: 600;
        }

        /* PESSOAS */
        .pessoas-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }
        
        .pessoa-card {
            background: var(--bg-card);
            border: 2px solid var(--bg-elevated);
            border-radius: var(--radius);
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pessoa-card:hover {
            border-color: rgba(232,184,109,0.5);
        }
        
        .pessoa-card.selected {
            border-color: var(--accent);
            background: rgba(232,184,109,0.1);
        }
        
        .pessoa-card .emoji {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .pessoa-card .nome {
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* √ÅUDIO */
        .audio-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 28px;
            text-align: center;
            border: 2px solid var(--bg-elevated);
        }
        
        .audio-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        .audio-title {
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 8px;
        }
        
        .audio-desc {
            color: var(--text-muted);
            margin-bottom: 24px;
        }
        
        .btn-gravar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--error), #DC2626);
            border: none;
            cursor: pointer;
            font-size: 2.5rem;
            transition: all 0.3s;
            box-shadow: 0 8px 30px rgba(239,68,68,0.4);
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .btn-gravar:hover { transform: scale(1.1); }
        .btn-gravar.gravando { animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239,68,68,0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(239,68,68,0); }
        }
        
        .tempo-gravacao {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
            font-family: monospace;
        }
        
        .tempo-limite {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .audio-preview {
            margin-top: 24px;
            padding: 20px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
        }
        
        .audio-preview audio {
            width: 100%;
            margin-bottom: 16px;
        }
        
        .audio-actions {
            display: flex;
            gap: 12px;
        }
        
        .audio-actions button {
            flex: 1;
            padding: 12px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
        }
        
        .btn-regravar {
            background: transparent;
            border: 2px solid var(--text-muted);
            color: var(--text-muted);
        }
        
        .btn-confirmar-audio {
            background: var(--success);
            border: none;
            color: white;
        }
        
        .audio-confirmado {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(16,185,129,0.15);
            border-radius: var(--radius-sm);
            margin-top: 20px;
        }
        
        .audio-confirmado .check { font-size: 1.5rem; }
        
        .btn-pular {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            margin-top: 20px;
            text-decoration: underline;
            font-family: 'Outfit', sans-serif;
        }

        /* PERGUNTAS */
        .pergunta-box {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }
        
        .pergunta-box label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            color: var(--accent);
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .pergunta-box input,
        .pergunta-box textarea {
            background: var(--bg-elevated);
            border: 2px solid transparent;
        }
        
        .pergunta-box input:focus,
        .pergunta-box textarea:focus {
            border-color: var(--accent);
        }
        
        .escala-felicidade {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .escala-num {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .escala-num:hover {
            border-color: var(--accent);
        }
        
        .escala-num.selected {
            background: var(--accent);
            color: var(--bg-dark);
        }

        /* BOT√ïES */
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: var(--bg-dark);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(232,184,109,0.3);
        }
        
        .btn-lacrar {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            font-size: 1.1rem;
            padding: 18px;
        }
        
        .btn-secondary {
            background: var(--bg-card);
            border: 2px solid var(--bg-elevated);
            color: var(--text);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btns-nav {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: auto;
            padding-top: 24px;
        }

        /* RESUMO */
        .resumo-section {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .resumo-section h4 {
            color: var(--accent);
            margin-bottom: 12px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resumo-item {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 8px;
        }
        
        .mini-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .mini-tag {
            background: rgba(232,184,109,0.2);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        /* LOADING */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15,20,25,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-capsula {
            font-size: 5rem;
            animation: shake 0.4s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        
        .loading-text {
            margin-top: 24px;
            font-size: 1.2rem;
            color: var(--accent);
        }

        /* SUCESSO */
        .tela-sucesso {
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .sucesso-foto {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 24px;
            border: 4px solid var(--accent);
            overflow: hidden;
            animation: pop 0.5s ease;
        }
        
        @keyframes pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .sucesso-foto img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sucesso-titulo {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 12px;
        }
        
        .sucesso-msg {
            color: var(--text-muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }
        
        .sucesso-data {
            background: var(--bg-card);
            padding: 16px 28px;
            border-radius: var(--radius-sm);
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .sucesso-dias {
            color: var(--text-muted);
            margin-bottom: 32px;
        }
        
        .sucesso-btns {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }
        
        .btn-compartilhar {
            background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045);
            color: white;
        }

        /* TELA ERRO */
        .tela-erro {
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .erro-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-elevated);
            color: var(--text);
            padding: 14px 24px;
            border-radius: var(--radius-sm);
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.error { border-color: var(--error); }

        /* CONFETES */
        .confetes {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1500;
        }
        
        .confete {
            position: absolute;
            animation: confeteFall 3s ease-out forwards;
        }
        
        @keyframes confeteFall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(110vh) rotate(720deg); }
        }
        
        input[type="file"] { display: none; }
        canvas { display: none; }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <div class="container">
        <!-- PROGRESS BAR -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-info">
                <span class="progress-step-text" id="progressStepText">Passo 1 de 6</span>
                <span class="progress-step-name" id="progressStepName">Identifica√ß√£o</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 16.66%"></div>
            </div>
        </div>

        <!-- TELA BOAS VINDAS -->
        <div class="tela active" id="telaBoas">
            <div class="tela-header" style="flex:1;display:flex;flex-direction:column;justify-content:center">
                <div class="tela-icon" style="font-size:5rem;animation:bounce 2s ease-in-out infinite">üéÅ</div>
                <h1 class="tela-title" id="eventoNome" style="font-size:2rem;color:var(--accent)">Carregando...</h1>
                <p class="tela-subtitle">Guarde mem√≥rias e desejos para abrir no futuro!</p>
                <div style="background:var(--bg-card);padding:16px 24px;border-radius:var(--radius-sm);margin:24px auto;color:var(--accent);font-weight:600" id="dataAberturaBox">
                    üìÖ Abre em: <span id="dataAbertura">--/--/----</span>
                </div>
            </div>
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="iniciar()" style="font-size:1.1rem;padding:18px">
                    ‚ú® Criar minha c√°psula
                </button>
            </div>
        </div>

        <!-- TELA 1: IDENTIFICA√á√ÉO -->
        <div class="tela" id="telaIdentificacao">
            <div class="tela-header">
                <div class="tela-icon">üì∏</div>
                <h2 class="tela-title">Quem √© voc√™?</h2>
                <p class="tela-subtitle">Tire uma foto e diga seu nome para o seu eu do futuro reconhecer!</p>
            </div>
            
            <div class="foto-area">
                <div class="foto-preview" id="fotoPreview" onclick="abrirGaleria()">
                    <div class="foto-placeholder" id="fotoPlaceholder">
                        <span class="icon">üì∑</span>
                        <span>Toque para adicionar</span>
                    </div>
                </div>
                <div class="foto-buttons">
                    <button class="btn-foto" onclick="abrirCamera()">üì∏ Selfie</button>
                    <button class="btn-foto" onclick="abrirGaleria()">üñºÔ∏è Galeria</button>
                </div>
                
                <div class="camera-container" id="cameraContainer">
                    <video id="cameraVideo" class="camera-video" autoplay playsinline></video>
                    <div class="camera-actions">
                        <button class="btn-cancel-camera" onclick="fecharCamera()">Cancelar</button>
                        <button class="btn-capture" onclick="capturarFoto()"></button>
                    </div>
                </div>
            </div>
            
            <input type="file" id="fotoInput" accept="image/*" onchange="processarFoto(event)">
            <canvas id="fotoCanvas"></canvas>
            
            <div class="form-group">
                <label>Seu nome</label>
                <input type="text" id="nome" placeholder="Como voc√™ se chama?" maxlength="30">
            </div>
            <div class="form-group">
                <label>Seu sobrenome</label>
                <input type="text" id="sobrenome" placeholder="Seu sobrenome" maxlength="30">
            </div>
            
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="irPara(2)">Continuar ‚Üí</button>
            </div>
        </div>

        <!-- TELA 2: DESEJOS -->
        <div class="tela" id="telaDesejos">
            <div class="tela-header">
                <div class="tela-icon">üåü</div>
                <h2 class="tela-title">Suas Prioridades</h2>
                <p class="tela-subtitle">O que voc√™ quer focar no pr√≥ximo ano?</p>
            </div>
            
            <div class="tags-counter">‚ú® Selecionados: <span id="contadorDesejos">0</span>/10</div>
            
            <div class="tags-section">
                <div class="categoria">
                    <div class="categoria-title">‚ù§Ô∏è Vida Pessoal</div>
                    <div class="tags-grid">
                        <span class="tag" onclick="toggleTag(this)">Sa√∫de</span>
                        <span class="tag" onclick="toggleTag(this)">Fam√≠lia</span>
                        <span class="tag" onclick="toggleTag(this)">Romance</span>
                        <span class="tag" onclick="toggleTag(this)">Amizades</span>
                        <span class="tag" onclick="toggleTag(this)">Paz interior</span>
                        <span class="tag" onclick="toggleTag(this)">Felicidade</span>
                    </div>
                </div>
                
                <div class="categoria">
                    <div class="categoria-title">üéØ Conquistas</div>
                    <div class="tags-grid">
                        <span class="tag" onclick="toggleTag(this)">Viajar</span>
                        <span class="tag" onclick="toggleTag(this)">Carreira</span>
                        <span class="tag" onclick="toggleTag(this)">Estudos</span>
                        <span class="tag" onclick="toggleTag(this)">Promo√ß√£o</span>
                        <span class="tag" onclick="toggleTag(this)">Neg√≥cio pr√≥prio</span>
                        <span class="tag" onclick="toggleTag(this)">Casa pr√≥pria</span>
                    </div>
                </div>
                
                <div class="categoria">
                    <div class="categoria-title">üí∞ Financeiro</div>
                    <div class="tags-grid">
                        <span class="tag" onclick="toggleTag(this)">Economizar</span>
                        <span class="tag" onclick="toggleTag(this)">Investir</span>
                        <span class="tag" onclick="toggleTag(this)">Quitar d√≠vidas</span>
                        <span class="tag" onclick="toggleTag(this)">Renda extra</span>
                    </div>
                </div>
                
                <div class="categoria">
                    <div class="categoria-title">üåà Bem-estar</div>
                    <div class="tags-grid">
                        <span class="tag" onclick="toggleTag(this)">Exerc√≠cios</span>
                        <span class="tag" onclick="toggleTag(this)">Medita√ß√£o</span>
                        <span class="tag" onclick="toggleTag(this)">Terapia</span>
                        <span class="tag" onclick="toggleTag(this)">Hobby novo</span>
                        <span class="tag" onclick="toggleTag(this)">Ler mais</span>
                        <span class="tag" onclick="toggleTag(this)">Dormir melhor</span>
                    </div>
                </div>
            </div>
            
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="irPara(3)">Continuar ‚Üí</button>
                <button class="btn btn-secondary" onclick="irPara(1)">‚Üê Voltar</button>
            </div>
        </div>

        <!-- TELA 3: PESSOAS -->
        <div class="tela" id="telaPessoas">
            <div class="tela-header">
                <div class="tela-icon">üë•</div>
                <h2 class="tela-title">Pessoas Importantes</h2>
                <p class="tela-subtitle">Com quem voc√™ quer se dedicar mais?</p>
            </div>
            
            <div class="pessoas-grid">
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Fam√≠lia">
                    <div class="emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="nome">Fam√≠lia</div>
                </div>
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Amigos">
                    <div class="emoji">üëØ</div>
                    <div class="nome">Amigos</div>
                </div>
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Parceiro(a)">
                    <div class="emoji">üíë</div>
                    <div class="nome">Parceiro(a)</div>
                </div>
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Filhos">
                    <div class="emoji">üë∂</div>
                    <div class="nome">Filhos</div>
                </div>
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Colegas">
                    <div class="emoji">üíº</div>
                    <div class="nome">Colegas</div>
                </div>
                <div class="pessoa-card" onclick="togglePessoa(this)" data-pessoa="Eu mesmo">
                    <div class="emoji">ü™û</div>
                    <div class="nome">Eu mesmo</div>
                </div>
            </div>
            
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="irPara(4)">Continuar ‚Üí</button>
                <button class="btn btn-secondary" onclick="irPara(2)">‚Üê Voltar</button>
            </div>
        </div>

        <!-- TELA 4: REFLEX√ïES -->
        <div class="tela" id="telaReflexoes">
            <div class="tela-header">
                <div class="tela-icon">üí≠</div>
                <h2 class="tela-title">Reflex√µes</h2>
                <p class="tela-subtitle">Responda para comparar com seu eu do futuro</p>
            </div>
            
            <div class="pergunta-box">
                <label>O que voc√™ acha que vai conquistar no pr√≥ximo ano?</label>
                <input type="text" id="perguntaConquista" placeholder="Ex: Falar ingl√™s fluente" maxlength="100">
            </div>
            
            <div class="pergunta-box">
                <label>Qual foi o momento mais marcante deste ano?</label>
                <input type="text" id="perguntaMomento" placeholder="Ex: Viagem com a fam√≠lia" maxlength="100">
            </div>
            
            <div class="pergunta-box">
                <label>Uma palavra que define seu momento atual</label>
                <input type="text" id="perguntaPalavra" placeholder="Ex: Gratid√£o, Esperan√ßa, Renova√ß√£o" maxlength="30">
            </div>
            
            <div class="pergunta-box">
                <label>De 1 a 10, qual sua nota de felicidade hoje?</label>
                <div class="escala-felicidade">
                    <div class="escala-num" onclick="selecionarFelicidade(1)">1</div>
                    <div class="escala-num" onclick="selecionarFelicidade(2)">2</div>
                    <div class="escala-num" onclick="selecionarFelicidade(3)">3</div>
                    <div class="escala-num" onclick="selecionarFelicidade(4)">4</div>
                    <div class="escala-num" onclick="selecionarFelicidade(5)">5</div>
                    <div class="escala-num" onclick="selecionarFelicidade(6)">6</div>
                    <div class="escala-num" onclick="selecionarFelicidade(7)">7</div>
                    <div class="escala-num" onclick="selecionarFelicidade(8)">8</div>
                    <div class="escala-num" onclick="selecionarFelicidade(9)">9</div>
                    <div class="escala-num" onclick="selecionarFelicidade(10)">10</div>
                </div>
            </div>
            
            <div class="pergunta-box">
                <label>Uma previs√£o para o pr√≥ximo ano</label>
                <input type="text" id="perguntaPrevisao" placeholder="Ex: Vou mudar de emprego" maxlength="100">
            </div>
            
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="irPara(5)">Continuar ‚Üí</button>
                <button class="btn btn-secondary" onclick="irPara(3)">‚Üê Voltar</button>
            </div>
        </div>

        <!-- TELA 5: √ÅUDIO -->
        <div class="tela" id="telaAudio">
            <div class="tela-header">
                <div class="tela-icon">üé§</div>
                <h2 class="tela-title">Mensagem de Voz</h2>
                <p class="tela-subtitle">Grave uma mensagem para seu eu do futuro</p>
            </div>
            
            <div class="audio-section" id="audioSection">
                <div class="audio-icon">üéôÔ∏è</div>
                <h3 class="audio-title">Deixe uma mensagem de voz</h3>
                <p class="audio-desc">M√°ximo 60 segundos. Fale do seu momento atual!</p>
                
                <button class="btn-gravar" id="btnGravar" onclick="toggleGravacao()">üé§</button>
                <div class="tempo-gravacao" id="tempoGravacao">00:00</div>
                <p class="tempo-limite">M√°ximo: 60 segundos</p>
                
                <div class="audio-preview" id="audioPreview" style="display:none">
                    <audio id="audioPlayback" controls></audio>
                    <div class="audio-actions">
                        <button class="btn-regravar" onclick="regravar()">üîÑ Regravar</button>
                        <button class="btn-confirmar-audio" onclick="confirmarAudio()">‚úÖ Usar</button>
                    </div>
                </div>
                
                <div class="audio-confirmado" id="audioConfirmado" style="display:none">
                    <span class="check">‚úÖ</span>
                    <div>
                        <strong>√Åudio gravado!</strong>
                        <p style="font-size:0.85rem;color:var(--text-muted)" id="audioDuracao">-- segundos</p>
                    </div>
                </div>
            </div>
            
            <button class="btn-pular" onclick="irPara(6)">Pular esta etapa ‚Üí</button>
            
            <div class="btns-nav">
                <button class="btn btn-primary" onclick="irPara(6)" id="btnContinuarAudio" style="display:none">Continuar ‚Üí</button>
                <button class="btn btn-secondary" onclick="irPara(4)">‚Üê Voltar</button>
            </div>
        </div>

        <!-- TELA 6: MENSAGEM -->
        <div class="tela" id="telaMensagem">
            <div class="tela-header">
                <div class="tela-icon">üíå</div>
                <h2 class="tela-title">Carta ao Futuro</h2>
                <p class="tela-subtitle">Escreva uma mensagem para voc√™ mesmo abrir daqui a um tempo</p>
            </div>
            
            <div class="form-group">
                <textarea id="mensagem" placeholder="Querido eu do futuro...

O que voc√™ est√° sentindo? O que espera do futuro? Conte tudo!" maxlength="2000" oninput="atualizarContador()"></textarea>
                <div class="char-counter"><span id="charCount">0</span>/2000 caracteres</div>
            </div>
            
            <!-- RESUMO -->
            <div class="resumo-section" id="resumoDesejos" style="display:none">
                <h4>üåü Suas prioridades</h4>
                <div class="mini-tags" id="resumoDesejosContent"></div>
            </div>
            
            <div class="resumo-section" id="resumoPessoas" style="display:none">
                <h4>üë• Pessoas importantes</h4>
                <div class="mini-tags" id="resumoPessoasContent"></div>
            </div>
            
            <div class="btns-nav">
                <button class="btn btn-lacrar" onclick="lacrarCapsula()" id="btnLacrar">
                    üîê Lacrar C√°psula
                </button>
                <button class="btn btn-secondary" onclick="irPara(5)">‚Üê Voltar</button>
            </div>
        </div>

        <!-- TELA SUCESSO -->
        <div class="tela tela-sucesso" id="telaSucesso">
            <div class="sucesso-foto" id="sucessoFoto">üéÅ</div>
            <h2 class="sucesso-titulo">C√°psula Lacrada!</h2>
            <p class="sucesso-msg" id="sucessoNome">Sua c√°psula foi guardada com sucesso.</p>
            <div class="sucesso-data" id="sucessoData">üìÖ --/--/----</div>
            <p class="sucesso-dias" id="sucessoDias">-- dias para abrir</p>
            
            <div class="sucesso-btns">
                <button class="btn btn-compartilhar" onclick="compartilhar()">üì§ Compartilhar</button>
                <button class="btn btn-primary" onclick="verCapsula()">üëÅÔ∏è Ver minha c√°psula</button>
                <button class="btn btn-secondary" onclick="voltarInicio()">üè† Voltar ao in√≠cio</button>
            </div>
        </div>

        <!-- TELA ERRO -->
        <div class="tela tela-erro" id="telaErro">
            <div class="erro-icon">‚ùå</div>
            <h2 class="tela-title">Ops!</h2>
            <p class="tela-subtitle" id="erroMsg">Evento n√£o encontrado ou j√° foi encerrado.</p>
            <button class="btn btn-primary" onclick="window.location.href='index.html'" style="margin-top:24px">
                Voltar ao in√≠cio
            </button>
        </div>
    </div>

    <!-- LOADING -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-capsula">üéÅ</div>
        <p class="loading-text" id="loadingText">Lacrando sua c√°psula...</p>
    </div>

    <!-- CONFETES -->
    <div class="confetes" id="confetesContainer"></div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script>
        // ==========================================
        // FIREBASE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyB2cNiBL1SU_QfjH_S_QGv_KSiFoocfqd4",
            authDomain: "capsuladotempo-f86bf.firebaseapp.com",
            databaseURL: "https://capsuladotempo-f86bf-default-rtdb.firebaseio.com",
            projectId: "capsuladotempo-f86bf",
            storageBucket: "capsuladotempo-f86bf.firebasestorage.app",
            messagingSenderId: "43014678980",
            appId: "1:43014678980:web:0c84f48037ee6924afdc91"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // ==========================================
        // VARI√ÅVEIS
        // ==========================================
        let eventoId = null;
        let eventoData = null;
        let capsulaId = null;
        let linkCapsula = null;
        
        let fotoBase64 = null;
        let desejosSelecionados = [];
        let pessoasSelecionadas = [];
        let felicidadeNota = null;
        
        let mediaRecorder = null;
        let audioChunks = [];
        let audioBlob = null;
        let audioUrl = null;
        let gravando = false;
        let tempoInicio = null;
        let tempoInterval = null;
        
        let cameraStream = null;

        const PASSOS = {
            1: { nome: 'Identifica√ß√£o', tela: 'telaIdentificacao' },
            2: { nome: 'Prioridades', tela: 'telaDesejos' },
            3: { nome: 'Pessoas', tela: 'telaPessoas' },
            4: { nome: 'Reflex√µes', tela: 'telaReflexoes' },
            5: { nome: '√Åudio', tela: 'telaAudio' },
            6: { nome: 'Mensagem', tela: 'telaMensagem' }
        };

        // ==========================================
        // UTILIT√ÅRIOS
        // ==========================================
        const gerarID = () => `cap_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        const formatarData = (d) => new Date(d).toLocaleDateString('pt-BR');
        
        const mostrarToast = (msg, tipo = 'success') => {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast show ${tipo}`;
            setTimeout(() => toast.className = 'toast', 3000);
        };

        // ==========================================
        // INICIALIZA√á√ÉO
        // ==========================================
        async function init() {
            const params = new URLSearchParams(window.location.search);
            eventoId = params.get('evento');
            
            if (!eventoId) {
                mostrarErro('Nenhum evento especificado');
                return;
            }
            
            try {
                const snapshot = await database.ref(`eventos/${eventoId}`).once('value');
                eventoData = snapshot.val();
                
                if (!eventoData) {
                    mostrarErro('Evento n√£o encontrado');
                    return;
                }
                
                if (eventoData.arquivado) {
                    mostrarErro('Este evento j√° foi encerrado');
                    return;
                }
                
                document.getElementById('eventoNome').textContent = eventoData.nome;
                document.getElementById('dataAbertura').textContent = formatarData(eventoData.dataAbertura);
                
            } catch (error) {
                console.error(error);
                mostrarErro('Erro ao carregar evento');
            }
        }
        
        function mostrarErro(msg) {
            document.getElementById('erroMsg').textContent = msg;
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('active'));
            document.getElementById('telaErro').classList.add('active');
            document.getElementById('progressContainer').style.display = 'none';
        }
        
        function iniciar() {
            document.getElementById('telaBoas').classList.remove('active');
            document.getElementById('telaIdentificacao').classList.add('active');
        }

        // ==========================================
        // NAVEGA√á√ÉO
        // ==========================================
        function irPara(passo) {
            // Valida√ß√µes
            if (passo === 2) {
                const nome = document.getElementById('nome').value.trim();
                if (!nome) {
                    mostrarToast('Digite seu nome', 'error');
                    return;
                }
            }
            
            // Mostrar resumo na tela 6
            if (passo === 6) {
                mostrarResumo();
            }
            
            // Atualizar progress
            document.getElementById('progressStepText').textContent = `Passo ${passo} de 6`;
            document.getElementById('progressStepName').textContent = PASSOS[passo].nome;
            document.getElementById('progressFill').style.width = `${(passo / 6) * 100}%`;
            
            // Trocar tela
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('active'));
            document.getElementById(PASSOS[passo].tela).classList.add('active');
        }
        
        function mostrarResumo() {
            const resumoDesejos = document.getElementById('resumoDesejos');
            const resumoPessoas = document.getElementById('resumoPessoas');
            
            if (desejosSelecionados.length > 0) {
                resumoDesejos.style.display = 'block';
                document.getElementById('resumoDesejosContent').innerHTML = 
                    desejosSelecionados.map(d => `<span class="mini-tag">${d}</span>`).join('');
            }
            
            if (pessoasSelecionadas.length > 0) {
                resumoPessoas.style.display = 'block';
                document.getElementById('resumoPessoasContent').innerHTML = 
                    pessoasSelecionadas.map(p => `<span class="mini-tag">${p}</span>`).join('');
            }
        }

        // ==========================================
        // FOTO
        // ==========================================
        function abrirGaleria() {
            document.getElementById('fotoInput').click();
        }
        
        async function abrirCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                document.getElementById('cameraVideo').srcObject = cameraStream;
                document.getElementById('cameraContainer').classList.add('active');
            } catch (error) {
                console.error(error);
                mostrarToast('N√£o foi poss√≠vel acessar a c√¢mera', 'error');
            }
        }
        
        function fecharCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('cameraContainer').classList.remove('active');
        }
        
        function capturarFoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('fotoCanvas');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0);
            
            fotoBase64 = canvas.toDataURL('image/jpeg', 0.8);
            
            document.getElementById('fotoPreview').innerHTML = `<img src="${fotoBase64}">`;
            document.getElementById('fotoPreview').classList.add('has-photo');
            
            fecharCamera();
        }
        
        function processarFoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.getElementById('fotoCanvas');
                    const size = Math.min(img.width, img.height);
                    canvas.width = 400;
                    canvas.height = 400;
                    
                    const ctx = canvas.getContext('2d');
                    const sx = (img.width - size) / 2;
                    const sy = (img.height - size) / 2;
                    ctx.drawImage(img, sx, sy, size, size, 0, 0, 400, 400);
                    
                    fotoBase64 = canvas.toDataURL('image/jpeg', 0.8);
                    document.getElementById('fotoPreview').innerHTML = `<img src="${fotoBase64}">`;
                    document.getElementById('fotoPreview').classList.add('has-photo');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ==========================================
        // TAGS / DESEJOS
        // ==========================================
        function toggleTag(el) {
            if (el.classList.contains('selected')) {
                el.classList.remove('selected');
                desejosSelecionados = desejosSelecionados.filter(d => d !== el.textContent);
            } else if (desejosSelecionados.length < 10) {
                el.classList.add('selected');
                desejosSelecionados.push(el.textContent);
            } else {
                mostrarToast('M√°ximo 10 desejos', 'error');
            }
            document.getElementById('contadorDesejos').textContent = desejosSelecionados.length;
        }

        // ==========================================
        // PESSOAS
        // ==========================================
        function togglePessoa(el) {
            const pessoa = el.dataset.pessoa;
            if (el.classList.contains('selected')) {
                el.classList.remove('selected');
                pessoasSelecionadas = pessoasSelecionadas.filter(p => p !== pessoa);
            } else {
                el.classList.add('selected');
                pessoasSelecionadas.push(pessoa);
            }
        }

        // ==========================================
        // FELICIDADE
        // ==========================================
        function selecionarFelicidade(nota) {
            felicidadeNota = nota;
            document.querySelectorAll('.escala-num').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.escala-num')[nota - 1].classList.add('selected');
        }

        // ==========================================
        // √ÅUDIO
        // ==========================================
        async function toggleGravacao() {
            if (gravando) {
                pararGravacao();
            } else {
                iniciarGravacao();
            }
        }
        
        async function iniciarGravacao() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('audioPlayback').src = audioUrl;
                    document.getElementById('audioPreview').style.display = 'block';
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                gravando = true;
                tempoInicio = Date.now();
                
                document.getElementById('btnGravar').classList.add('gravando');
                document.getElementById('btnGravar').innerHTML = '‚èπÔ∏è';
                
                tempoInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - tempoInicio) / 1000);
                    const min = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const sec = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('tempoGravacao').textContent = `${min}:${sec}`;
                    
                    if (elapsed >= 60) pararGravacao();
                }, 1000);
                
            } catch (error) {
                console.error(error);
                mostrarToast('N√£o foi poss√≠vel acessar o microfone', 'error');
            }
        }
        
        function pararGravacao() {
            if (mediaRecorder && gravando) {
                mediaRecorder.stop();
                gravando = false;
                clearInterval(tempoInterval);
                
                document.getElementById('btnGravar').classList.remove('gravando');
                document.getElementById('btnGravar').innerHTML = 'üé§';
            }
        }
        
        function regravar() {
            audioBlob = null;
            audioUrl = null;
            document.getElementById('audioPreview').style.display = 'none';
            document.getElementById('tempoGravacao').textContent = '00:00';
        }
        
        function confirmarAudio() {
            const duracao = document.getElementById('tempoGravacao').textContent;
            document.getElementById('audioSection').style.display = 'none';
            document.getElementById('audioConfirmado').style.display = 'flex';
            document.getElementById('audioDuracao').textContent = duracao;
            document.getElementById('btnContinuarAudio').style.display = 'flex';
            document.querySelector('.btn-pular').style.display = 'none';
        }

        // ==========================================
        // MENSAGEM
        // ==========================================
        function atualizarContador() {
            const count = document.getElementById('mensagem').value.length;
            document.getElementById('charCount').textContent = count;
        }

        // ==========================================
        // LACRAR C√ÅPSULA
        // ==========================================
        async function lacrarCapsula() {
            const nome = document.getElementById('nome').value.trim();
            const sobrenome = document.getElementById('sobrenome').value.trim();
            const mensagem = document.getElementById('mensagem').value.trim();
            
            if (!nome) {
                mostrarToast('Digite seu nome', 'error');
                return;
            }
            
            document.getElementById('btnLacrar').disabled = true;
            document.getElementById('loadingOverlay').classList.add('active');
            
            try {
                capsulaId = gerarID();
                let fotoUrl = null;
                let audioUrlFinal = null;
                
                // Upload foto
                if (fotoBase64) {
                    document.getElementById('loadingText').textContent = 'Salvando foto...';
                    const fotoRef = storage.ref(`capsulas/${capsulaId}/foto.jpg`);
                    await fotoRef.putString(fotoBase64.split(',')[1], 'base64', { contentType: 'image/jpeg' });
                    fotoUrl = await fotoRef.getDownloadURL();
                }
                
                // Upload √°udio
                if (audioBlob) {
                    document.getElementById('loadingText').textContent = 'Salvando √°udio...';
                    const audioRef = storage.ref(`capsulas/${capsulaId}/audio.webm`);
                    await audioRef.put(audioBlob);
                    audioUrlFinal = await audioRef.getDownloadURL();
                }
                
                // Salvar c√°psula
                document.getElementById('loadingText').textContent = 'Lacrando c√°psula...';
                
                const capsula = {
                    eventoId: eventoId,
                    nome: nome,
                    sobrenome: sobrenome,
                    foto: fotoUrl,
                    desejos: desejosSelecionados,
                    pessoas: pessoasSelecionadas,
                    perguntas: {
                        conquista: document.getElementById('perguntaConquista').value.trim(),
                        momento: document.getElementById('perguntaMomento').value.trim(),
                        palavra: document.getElementById('perguntaPalavra').value.trim(),
                        felicidade: felicidadeNota,
                        previsao: document.getElementById('perguntaPrevisao').value.trim()
                    },
                    audio: audioUrlFinal,
                    mensagemPessoal: mensagem,
                    dataCriacao: new Date().toISOString(),
                    dataAbertura: eventoData.dataAbertura,
                    liberada: false,
                    aberta: false
                };
                
                await database.ref(`capsulas/${capsulaId}`).set(capsula);
                
                linkCapsula = `${window.location.href.split('?')[0].replace('jogador.html', 'capsula.html')}?id=${capsulaId}`;
                
                // Sucesso!
                document.getElementById('loadingOverlay').classList.remove('active');
                mostrarSucesso();
                
            } catch (error) {
                console.error(error);
                document.getElementById('loadingOverlay').classList.remove('active');
                document.getElementById('btnLacrar').disabled = false;
                mostrarToast('Erro ao salvar. Tente novamente.', 'error');
            }
        }
        
        function mostrarSucesso() {
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('active'));
            document.getElementById('telaSucesso').classList.add('active');
            document.getElementById('progressContainer').style.display = 'none';
            
            // Atualizar dados
            if (fotoBase64) {
                document.getElementById('sucessoFoto').innerHTML = `<img src="${fotoBase64}">`;
            }
            
            const nome = document.getElementById('nome').value;
            document.getElementById('sucessoNome').textContent = `${nome}, sua c√°psula foi guardada com sucesso!`;
            document.getElementById('sucessoData').textContent = `üìÖ ${formatarData(eventoData.dataAbertura)}`;
            
            const dias = Math.ceil((new Date(eventoData.dataAbertura) - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('sucessoDias').textContent = `${dias} dias para abrir`;
            
            criarConfetes();
        }
        
        function criarConfetes() {
            const container = document.getElementById('confetesContainer');
            container.innerHTML = '';
            const cores = ['#E8B86D', '#2D5A4C', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];
            
            for (let i = 0; i < 100; i++) {
                const confete = document.createElement('div');
                confete.className = 'confete';
                confete.style.left = Math.random() * 100 + '%';
                confete.style.animationDelay = Math.random() * 2 + 's';
                confete.style.backgroundColor = cores[Math.floor(Math.random() * cores.length)];
                confete.style.width = (Math.random() * 10 + 5) + 'px';
                confete.style.height = (Math.random() * 10 + 5) + 'px';
                confete.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                container.appendChild(confete);
            }
            
            setTimeout(() => container.innerHTML = '', 4000);
        }

        // ==========================================
        // A√á√ïES FINAIS
        // ==========================================
        function compartilhar() {
            if (navigator.share) {
                navigator.share({
                    title: 'Minha C√°psula do Tempo',
                    text: 'Acabei de lacrar minha c√°psula do tempo! üéÅ',
                    url: linkCapsula
                });
            } else {
                navigator.clipboard.writeText(linkCapsula).then(() => {
                    mostrarToast('Link copiado!');
                });
            }
        }
        
        function verCapsula() {
            window.location.href = linkCapsula;
        }
        
        function voltarInicio() {
            window.location.href = 'index.html';
        }

        // ==========================================
        // INIT
        // ==========================================
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
